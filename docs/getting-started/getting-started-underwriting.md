---
tags: [Getting Started, Underwriting, Risk, Application]
---

# Risk services

## Risk services available in Exchange

If using Risk services in Exchange the PayFac will be able enable Credit risk and OFAC Screening, as well as OFAC monitoring for the sub-merchant. 
The PayFac will be responsible for reviewing any possible matches retrieved at the business and pricinipal levels to ensure that there is not match with the OFAC list. 

<!-- theme: danger -->
> **If an OFAC hit is confirmed, the sub-merchant cannot be boarded and if already on the system will be held from funding.**

 
## Screening

After intial configurations have be done to setup screening, the PayFac will be able to retrieve reports that are generated during the boarding process for their sub-merchants by API. All previous processes required must have been completed for the application before starting the risk process. 
After retrieving the reports, the PayFac will manually review all potential matches generated by the third parties. Reports can be confirmed or discounted.
If confirming the report, the PayFac is confirming that the potential match is valid. To discount , means that the potential match in incorrect and does not match the business or principal. For Credit risk reports, the user will have to confirm the reports and make the underwriting decision for the application (only available for 'full-service' clients). 

<!-- theme: danger -->
> **For AML, the application will be cancelled if any potential match is confirmed.** 

### Available screening API

#### Retrieve intelligence reports available

The `/intelligence/retrieve_intelligence` endpoint can be used to retrieve all avaliable screening reports for a sub-merchant application. This will include the business level, and the principal level. Each entry in the response will return an `entity_reference` to use in the `/intelligence/retrieve_report`.

#### Retrieve intelligence reports

After retrieving the `entity_reference` from  the `/intelligence/retrieve_intelligence` endpoint, the PayFac can then view each report through the `/intelligence/retrieve_report` endpoint.

#### Overwrite intelligence reports

This `/intelligence/overwrite_aml_reports` is used to overwrite OFAC reports for potential matches. The potential matches will need to be confirmed or discounted for the application where these are found. If any applications match it confirmed, the application will have to be cancelled. The user must add a review note for each entity as required. The request will need to contain the `intelligence_ref` and the `match_reference` for each entity overwritten. The decision will be added to the `status` as `"EM"` or `"NM"` , where EM represents Exact Match and NM represent No Match. Multiple reports can be reviewed in one request.

#### Overwrite credit risk check reports

The `/intelligence/overwrite_risk_reports` will be used to overwrite a credit risk check decision. This will only be applicable for PayFacs who are operating as a 'full-service' to retrieve reports from a third party. The `overall_decision` field will contain the final decision that the user is overwriting the generated decision for report for.

#### Application decision

After the reports for AML and credit risk have been reviewed for an application, the user can use the `/intelligence/decision` endpoint in order to make a decision for the AML and Credit Risk Process. The `decision` will be used to approve or decline the application, where `APPROVE` and `DECLINE` can be sent.

## Monitoring

Monitoring must be enabled before the applications are submitted, and the user will not be able to retroactively enable monitoring for an application after it was been boarded. If enabled, the system will monitor sub-merchants every day. The user will be able to make an API call in  order to check if any alert has been raised or material for their sub-merchants has changed. If an alert has been raised, the user can retrieve the reports for this and manually review (like during the screening process).
If an OFAC alert has been raised, the system will automatically *hold* the sub-merchant, meaning that no funding will be able to happen for the sub-merchant. The reviewer will then need to discount all potential matches from the alert. Once discounted, this will automatically unhold the sub-merchant to re-enable funding.

### Available monitoring API

#### Retrieve monitoring hits

The user will be able to retrieve the hits recieved for a sub-merchant that is being monitored through the `/monitoring/retrieve_hits` endpoint. This can be called to summarise if there are any reports that need to be reviewed, and requires the `merchant_id` to be sent to identify which sub-merchant is being checked. This will respond with the type of entity the hit was found on, which factor (ie. Director Change) and which third party the information was sourced from.

#### Retrieve monitoring reports

After retrieving the available reports for a sub-merchant, the user can then view the reports through the `/monitoring/retrieve_report` endpoint. This will require the entity type to be sent along with the references for the report. This will respond witht he information gathered from the third party for the report and will be required to be reviewed.

#### Overwrite intelligence reports

Once a report has been reviewed, the user will be able to overwrite the decision for the reports using the `/monitoring/overwrite_intelligence_report` endpoint.
This will require the `report_reference` to define the report, and the `intelligence_report` for the entities report that is being overwritten. The status will be sent in the request in order for the review to be made. The `status` can be sent as `"NM"` for No Matches, and `"EM"` for an Exact Match.

## Standard Process timeline steps

<!-- !align: center -->
![boarding_flow](/assets/images/risk_workflow.png)

<!--
type: tab
titles: Screening steps, Monitoring Steps
-->

#### Screening

1. User will board new application to system, and return the application status *"awaiting checks"*.
2. User will return all available reports using the `intelligence/retrieve_intelligence` with the `application_reference`.
3. User will retrieve specific reports using `intelligence/retrieve_report` for the `application_reference`, `intelligence_ref`, and `third_party_source`.
4. User will overwrite details for the aml reports using `intelligence/overwrite_aml_reports` for the `application_reference` with the details needed for overwriting.
5. User will overwrite details for the credit risk using `intelligence/overwrite_risk_reports` for the `application_reference` with the details needed for overwriting.
6. Final decision to be made for AML and Credit risk, using the `intelligence/decision` for the `application_reference` with the AML and Risk decision.

---

<!-- type: tab -->

#### Monitoring

1. User will use `monitoring/retrieve_hits` to check if any alerts have occured for their `merchant_id`, and return the alert summary and available reports list.
2. User will retrieve reports using `/monitoring/retrieve_report` for the entity and `report_reference` to return the report details.
3. User will overwrite the report using the `monitoring/overwrite_intelligence_report` endpoint for the `application_reference` with the details needed for overwriting.

<!-- type: tab-end -->

---


## Submission Errors

After an application is submit, it will move to underwriting. If there are every cases where a Credit Risk Error or AML error is recieved due to invalid data, an application can be unlocked in order to be updated and resubmit using the unlock application endpoint

```json
{
  "operation": {
    "operation_type": "APPLICATION_UNLOCK"
  },
  "application": {
    "application_external_id": "APL01-75CDF-663EB-79CBA-DF321-BEUIP-KL123"
  }
}
```

## Shared Services Back to Sales Flow

When using shared services, the user may be asked to provide additional documentation during the credit risk screening process. 
This will occur when an application is being manually reviewed, and may require supporting documents such as Bank statements or proof of address. 

### In Manual Review / Back to Sales

This response will be sent to Exchange from credit as a 'back to sales' response, with a comment to let the user know why this has occured and what is required.
This will be checked by retrieving the merchant applications information through `/boarding/application` operation `'RETRIEVE_MERCHANT_HIERARCHY'` , where the `"credit_risk_check_response"` block will contain the current credit risk check info for the application. A `"decision": "MORE_INFO_REQUIRED"` indicates that the back to sales message has been recieved and is ready to be processed, where the risk reviewers comment `"credit_risk_comments":` can be viewed in order to know what is required to upload.

### Response process

The user will be able to respond to the credit team with the additional documents requested by uploading them and submitting a comment back, 
which will be facilitated through the `/fdapplication/upload_additional_files` , `/fdapplication/submit_additional_documents` and `/boarding/document_categories` endpoints.

#### Retrieving document categories

In order to upload a file, it must be assigned a category to be uploaded to. This will need to have been configured on the configuration portal prior to retrieving. 
The available categories are: 

- Proof of ID
- Proof of Business
- Proof of Address
- Other

These will have documents grouped within this category during the configuration done. The `tenant_udc_external_id` will be returned for the categories displayed.

#### Uploading the files

The files to upload will be sent through the `/fdapplication/upload_additional_files` for the application application reference stated, and will require the payload to be sent as form-data. 
The form will require two keys, `request` and `file` - where the request is the body and file is an uploaded file. Only one file at a time can be sent through the api

The request must contain the application reference, and the external id of what entity the document is for.

Example request body:
```
{
    "application": {
        "application_reference": "333020220715",
        "tenant_udc_external_id": "TDC08-23KS2-823JR-72240-34KDF-CAE91-EFB47"
    }
}
```

However, this request body will be dependant on the configuration of the documents. If mandatory meta data has been configured for the document, this must be added in the request body under a `document_data` object, seen below.

```
{
    "application": {
        "application_reference": "333020220715",
        "tenant_udc_external_id": "TDC08-23KS2-823JR-72240-34KDF-CAE91-EFB47"
    },
    "document_data": {
        "first_name": "Test",
        "second_name": "Test",
        "sur_name": "Test",
        "date_of_birth": "1998/10/24",
        "document_id": "CWR442DF2FD",
        "issued_date": "2022/06/10",
        "expiry_date": "2032/06/10",
        "document_issuer": "Test",
        "issuing_state": "CA",
        "issuing_country": "840"
    }
}
```
#### Submitting the documents

After all the files have been uploaded that have been requested, the user may now submit the documents to Exchange along with a note for the risk reviewer to see when viewing the documents. This can be used to talk to the credit risk reviewer.
```
{
    "operation": {
        "operation_type": "APPLICATION_SUBMIT_ADDITIONAL_DOCUMENTS",
        "version": "2.0.0"
    },
    "application": {
        "application_reference": "333020220715"
    },
    "note": "Please see additional documents, with statement from January as requested."
}
```

After submitting the documents, Exchange will notify the credit reviewer in order to view the documents. After these have been reviewed and processed, the credit risk process will proceed or may require additional documents again to proceed.

